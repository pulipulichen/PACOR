<!DOCTYPE html>
<html>
  <head>
    <title>2020 exp pretest articles</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <!-- 在尾端加上日期 -->
    <script src="/lib/bootstrap/jquery-3.4.1.slim.min.js"></script>
    <script>
      //console.log(document.referrer, typeof(document.referrer))
      
      // 500
      // 
      // hsinchu-wind
      // microscope
      // rice
      // three-mountains-king
      // yakutsk
      // 
      // 1000
      // 
      // bat-virus 
      // colorectal-cancer
      // sakura
      //
      
      
      if (document.referrer === ''
              || document.referrer === 'http://pc.pulipuli.info:3333/'
              || !document.referrer.startsWith('http://pc.pulipuli.info:3333/')) {
        let d = new Date();
        let mmdd = [
          ('0' + (d.getMonth() + 1)).slice(-2),
          ('0' + d.getDate()).slice(-2)
        ].join('')
        
        let h = d.getHours()
        
        // 加上日期偏移
        let date = d.getDate()
        let adjust = parseInt(24 / 5, 10)
        h = (h + date * adjust) % 24
        
        let article = 'hsinchu-wind'
        if (h > 5 && h <= 10) {
          article = 'microscope'
        }
        else if (h > 10 && h <= 15) {
          article = 'yakutsk'
        }
        else if (h > 15 && h <= 20) {
          article = 'three-mountains-king'
        }
        else if (h > 20 && h <= 23) {
          article = 'rice'
        }

        let readingPage = '/pretest/beta/individual/' + article + '/' + mmdd
        //console.log(readingPage)

        location.href = readingPage
      }
      else {
        let parts = document.referrer.split('/')
        let len = parts.length
        let article = parts[(len - 2)]
        
        let mapping = {
          'hsinchu-wind': 'bat-virus',
          'microscope': 'bat-virus',
          'rice': 'sakura',
          'three-mountains-king': 'sakura',
          'yakutsk': 'colorectal-cancer',
        }

        if (typeof(mapping[article]) === 'string') {
          article = mapping[article]
        }
        else {
          window.alert('Finish!')
          article = null
        }

        if (article) {
          parts[(len - 2)] = article
          parts[(len - 3)] = 'collaborative'
          console.log(parts.join('/'))
          location.href = parts.join('/')
        }
      }
    </script>
  </body>
</html>
