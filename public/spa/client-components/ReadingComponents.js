(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{189:function(e,t,n){var r=n(302);"string"==typeof r&&(r=[[e.i,r,""]]);var o={insert:"head",singleton:!1};n(6)(r,o);r.locals&&(e.exports=r.locals)},190:function(e,t,n){var r=n(304);"string"==typeof r&&(r=[[e.i,r,""]]);var o={insert:"head",singleton:!1};n(6)(r,o);r.locals&&(e.exports=r.locals)},191:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"TEST_MESSAGE":"Test Message"},"zh-TW":{"TEST_MESSAGE":"測試訊息"}}'),delete e.options._Ctor}},301:function(e,t,n){"use strict";var r=n(189);n.n(r).a},302:function(e,t,n){(e.exports=n(5)(!1)).push([e.i,"@media print{.annotate-panel{display:none}.highlight{background-color:#ff0}}.highlight{background-color:#ff0}.annotate-panel{position:fixed;display:none;background-color:#fff;background-color:#ccc;border-radius:10px;box-shadow:5px 5px 2px grey;user-select:none}.annotate-panel.show{display:inline-block}.annotate-panel .button{border-width:0;background-color:transparent;text-align:center;display:inline-block;cursor:pointer;font-size:.8em;padding:5px}.annotate-panel .button.highlightSelectedText{border-radius:10px 0 0 10px}.annotate-panel .button.removeHighlightFromSelectedText{border-radius:0 10px 10px 0;margin-left:-5px}.annotate-panel .button-container{border-right:3px ridge #fff;display:inline-block}.annotate-panel .button:hover{background-color:#ff0}.annotate-panel .button-container:last-of-type{border-right-width:0;padding-right:0}.annotate-panel.hide-remove .button-container.remove{display:none}.annotate-panel.hide-remove .button-container{border-right-width:0;padding-right:0}.annotate-panel.hide-remove .button{border-radius:10px}.rangy-container-test{position:fixed;top:100px;left:100px;background-color:red}.note{color:red}.italicYellowBg{font-style:italic;background-color:#ff0}.boldRed{font-weight:700;color:red}img.boldRed{border:3px solid red}a.pinkLink{color:#f66;font-size:1.2em}.pacor-selection{background-color:rgba(0,0,255,.7);color:#fff}",""])},303:function(e,t,n){"use strict";var r=n(190);n.n(r).a},304:function(e,t,n){(e.exports=n(5)(!1)).push([e.i,".fab-main-container[data-v-31e52695]{right:5rem!important;bottom:5rem!important}.fab-main-container.hidden[data-v-31e52695]{display:none}",""])},305:function(e,t,n){"use strict";var r=n(191),o=n.n(r);t.default=o.a},311:function(e,t,n){"use strict";n.r(t);function r(){var e=this.$createElement;return(this._self._c||e)("fragment")}r._withStripped=!0;var o=n(1),ie=n.n(o),i="object",a="function",s="undefined",c=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],l=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],u=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],d=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function h(e,t){var n=ie()(e[t]);return n==a||!(n!=i||!e[t])||"unknown"==n}function f(e,t){return!(ie()(e[t])!=i||!e[t])}function g(e,t){return ie()(e[t])!=s}function p(r){return function(e,t){for(var n=t.length;n--;)if(!r(e,t[n]))return!1;return!0}}var m=p(h),v=p(f),R=p(g);function C(e){return e&&m(e,d)&&R(e,u)}function N(e){return f(e,"body")?e.body:e.getElementsByTagName("body")[0]}var E,y,S=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)t(e[n],n)},T={},w=("undefined"==typeof window?"undefined":ie()(window))!=s&&("undefined"==typeof document?"undefined":ie()(document))!=s,A={isHostMethod:h,isHostObject:f,isHostProperty:g,areHostMethods:m,areHostObjects:v,areHostProperties:R,isTextRange:C,getBody:N,forEach:S},x={version:"1.3.1-dev",initialized:!1,isBrowser:w,supported:!0,util:A,features:{},modules:T,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:("undefined"==typeof rangyAutoInitialize?"undefined":ie()(rangyAutoInitialize))==s||rangyAutoInitialize}};function b(e){("undefined"==typeof console?"undefined":ie()(console))!=s&&h(console,"log")&&console.log(e)}function O(e,t){w&&t?alert(e):b(e)}function _(e){x.initialized=!0,x.supported=!1,O("Rangy is not supported in this environment. Reason: "+e,x.config.alertOnFail)}x.fail=_,x.warn=function(e){O("Rangy warning: "+e,x.config.alertOnWarn)},!{}.hasOwnProperty?_("hasOwnProperty not supported"):(A.extend=E=function(e,t,n){var r,o;for(var i in t)t.hasOwnProperty(i)&&(r=e[i],o=t[i],n&&null!==r&&"object"==ie()(r)&&null!==o&&"object"==ie()(o)&&E(r,o,!0),e[i]=o);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},A.createOptions=function(e,t){var n={};return E(n,t),e&&E(n,e),n}),w||_("Rangy can only run in a browser"),function(){var e;if(w){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(e){}}e=e||function(e){for(var t=[],n=0,r=e.length;n<r;++n)t[n]=e[n];return t},A.toArray=e}(),w&&(h(document,"addEventListener")?y=function(e,t,n){e.addEventListener(t,n,!1)}:h(document,"attachEvent")?y=function(e,t,n){e.attachEvent("on"+t,n)}:_("Document does not have required addEventListener or attachEvent method"),A.addListener=y);var D=[];function P(e){return e.message||e.description||String(e)}function I(){if(w&&!x.initialized){var e,t=!1,n=!1;h(document,"createRange")&&(e=document.createRange(),m(e,l)&&R(e,c)&&(t=!0));var r=N(document);if(r&&"body"==r.nodeName.toLowerCase())if(r&&h(r,"createTextRange")&&C(e=r.createTextRange())&&(n=!0),t||n){var o;for(var i in x.initialized=!0,x.features={implementsDomRange:t,implementsTextRange:n},T)(o=T[i])instanceof k&&o.init(o,x);for(var a=0,s=D.length;a<s;++a)try{D[a](x)}catch(e){b("Rangy init listener threw an exception. Continuing. Detail: "+P(e))}}else _("Neither Range nor TextRange are available");else _("No body element found")}}function M(e,t,n){n&&(e+=" in module "+n.name),x.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function B(e,t,n,r){e[t]=function(){return M(t,n,r),e[n].apply(e,A.toArray(arguments))}}A.deprecationNotice=M,A.createAliasForDeprecatedMethod=B,x.init=I,x.addInitListener=function(e){x.initialized?e(x):D.push(e)};var H=[];function k(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function W(t,e,n){var r=new k(t,e,function(e){if(!e.initialized){e.initialized=!0;try{n(x,e),e.supported=!0}catch(e){b("Module '"+t+"' failed to load: "+P(e)),e.stack&&b(e.stack)}}});return T[t]=r}function L(){}x.addShimListener=function(e){H.push(e)},w&&(x.shim=x.createMissingNativeApi=function(e){e=e||window,I();for(var t=0,n=H.length;t<n;++t)H[t](e)},B(x,"createMissingNativeApi","shim")),k.prototype={init:function(){for(var e,t,n=this.dependencies||[],r=0,o=n.length;r<o;++r){if(t=n[r],!((e=T[t])&&e instanceof k))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){x.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){x.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},x.createModule=function(e){var t,n=W(e,2==arguments.length?(t=arguments[1],[]):(t=arguments[2],arguments[1]),t);x.initialized&&x.supported&&n.init()},x.createCoreModule=function(e,t,n){W(e,t,n)},x.RangePrototype=L,x.rangePrototype=new L,x.selectionPrototype=new function(){},x.createCoreModule("DomUtil",[],function(n,l){var r="undefined",o=n.util,a=o.getBody;o.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||l.fail("document missing a Node creation method"),o.isHostMethod(document,"getElementsByTagName")||l.fail("document missing getElementsByTagName method");var e=document.createElement("div");o.areHostMethods(e,["insertBefore","appendChild","cloneNode"])||l.fail("Incomplete Element implementation"),o.isHostProperty(e,"innerHTML")||l.fail("Element is missing innerHTML property");var t=document.createTextNode("test");o.areHostMethods(t,["splitText","deleteData","insertData","appendData","cloneNode"])||l.fail("Incomplete Text Node implementation");var i=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};function u(e){for(var t=0;e=e.previousSibling;)++t;return t}function d(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(i(r,n))return n;return null}function s(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function h(e,t,n){for(var r,o=n?e:e.parentNode;o;){if((r=o.parentNode)===t)return o;o=r}return null}function c(e){var t=e.nodeType;return 3==t||4==t||8==t}function f(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function g(e){if(9==e.nodeType)return e;if(ie()(e.ownerDocument)!=r)return e.ownerDocument;if(ie()(e.document)!=r)return e.document;if(e.parentNode)return g(e.parentNode);throw l.createError("getDocument: no document found for node")}function p(e){var t=g(e);if(ie()(t.defaultView)!=r)return t.defaultView;if(ie()(t.parentWindow)!=r)return t.parentWindow;throw l.createError("Cannot get a window object for node")}function m(e){if(ie()(e.contentDocument)!=r)return e.contentDocument;if(ie()(e.contentWindow)!=r)return e.contentWindow.document;throw l.createError("getIframeDocument: No Document object found for iframe element")}function v(e){return e&&o.isHostMethod(e,"setTimeout")&&o.isHostObject(e,"document")}var R,C=!1;function N(e){try{return e.parentNode,!1}catch(e){return!0}}function E(e){if(!e)return"[No node]";if(C&&N(e))return"[Broken node]";if(c(e))return'"'+e.data+'"';if(1!=e.nodeType)return e.nodeName;var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+u(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}function y(e){this.root=e,this._next=e}function S(e,t){this.node=e,this.offset=t}function T(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}!function(){var e=document.createElement("b");e.innerHTML="1";var t=e.firstChild;e.innerHTML="<br />",C=N(t),n.features.crashyTextNodes=C}(),ie()(window.getComputedStyle)!=r?R=function(e,t){return p(e).getComputedStyle(e,null)[t]}:ie()(document.documentElement.currentStyle)!=r?R=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:l.fail("No means of obtaining computed style properties found"),y.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},S.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+E(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},(T.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24}).toString=function(){return this.message},n.dom={arrayContains:i,isHtmlNamespace:function(e){var t;return ie()(e.namespaceURI)==r||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(e){var t=e.parentNode;return 1==t.nodeType?t:null},getNodeIndex:u,getNodeLength:function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:d,isAncestorOf:s,isOrIsAncestorOf:function(e,t){return s(e,t,!0)},getClosestAncestorIn:h,isCharacterDataNode:c,isTextOrCommentNode:function(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t},insertAfter:f,splitDataNode:function(e,t,n){var r=e.cloneNode(!1);if(r.deleteData(0,t),e.deleteData(t,e.length-t),f(r,e),n)for(var o,i=0;o=n[i++];)o.node==e&&o.offset>t?(o.node=r,o.offset-=t):o.node==e.parentNode&&o.offset>u(e)&&++o.offset;return r},getDocument:g,getWindow:p,getIframeWindow:function(e){if(ie()(e.contentWindow)!=r)return e.contentWindow;if(ie()(e.contentDocument)!=r)return e.contentDocument.defaultView;throw l.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:m,getBody:a,isWindow:v,getContentDocument:function(e,t,n){var r;if(e?o.isHostProperty(e,"nodeType")?r=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):g(e):v(e)&&(r=e.document):r=document,!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,t,n,r){var o,i,a,s,c;if(e==n)return t===r?0:t<r?-1:1;if(o=h(n,e,!0))return t<=u(o)?-1:1;if(o=h(e,n,!0))return u(o)<r?-1:1;if(!(i=d(e,n)))throw new Error("comparePoints error: nodes have no common ancestor");if((a=e===i?i:h(e,i,!0))===(s=n===i?i:h(n,i,!0)))throw l.createError("comparePoints got to case 4 and childA and childB are the same!");for(c=i.firstChild;c;){if(c===a)return-1;if(c===s)return 1;c=c.nextSibling}},isBrokenNode:N,inspectNode:E,getComputedStyleProperty:R,createTestElement:function(e,t,n){var r=a(e),o=e.createElement("div");o.contentEditable=""+!!n,t&&(o.innerHTML=t);var i=r.firstChild;return i?r.insertBefore(o,i):r.appendChild(o),o},removeNode:function(e){return e.parentNode.removeChild(e)},fragmentFromNodeChildren:function(e){for(var t,n=g(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new y(e)},DomPosition:S},n.DOMException=T}),x.createCoreModule("DomRange",["DomUtil"],function(a,e){var s=a.dom,r=a.util,t=s.DomPosition,c=a.DOMException,d=s.isCharacterDataNode,h=s.getNodeIndex,l=s.isOrIsAncestorOf,o=s.getDocument,f=s.comparePoints,u=s.splitDataNode,g=s.getClosestAncestorIn,p=s.getNodeLength,i=s.arrayContains,m=s.getRootContainer,n=a.features.crashyTextNodes,v=s.removeNode;function R(e,t){return 3!=e.nodeType&&(l(e,t.startContainer)||l(e,t.endContainer))}function C(e){return e.document||o(e.startContainer)}function N(e){return new t(e.parentNode,h(e))}function E(e){return new t(e.parentNode,h(e)+1)}function y(e,t,n){var r=11==e.nodeType?e.firstChild:e;return d(t)?n==t.length?s.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:u(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function S(e,t,n){if(U(e),U(t),C(t)!=C(e))throw new c("WRONG_DOCUMENT_ERR");var r=f(e.startContainer,e.startOffset,t.endContainer,t.endOffset),o=f(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?r<=0&&0<=o:r<0&&0<o}function T(e,t,n){var r,o,i,a;for(n=n||{stop:!1};i=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(i))return void(n.stop=!0);if(T(a=e.getSubtreeIterator(),t,n),a.detach(),n.stop)return}else for(r=s.createIterator(i);o=r.next();)if(!1===t(o))return void(n.stop=!0)}function w(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(w(t=e.getSubtreeIterator()),t.detach()):e.remove()}function A(e){for(var t,n,r=C(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(A(n)),n.detach()):e.remove(),10==t.nodeType)throw new c("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function x(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+s.inspectNode(e.startContainer)+":"+e.startOffset+", "+s.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function b(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&d(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||d(this.sc)?g(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||d(this.ec)?g(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}b.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,d(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!d(n)||n!==this.sc&&n!==this.ec?n.parentNode&&v(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return R(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new he(C(this.range));var t=this._current,n=t,r=0,o=t,i=p(t);l(t,this.sc)&&(n=this.sc,r=this.so),l(t,this.ec)&&(o=this.ec,i=this.eo),de(e,n,r,o,i)}return new b(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var O=[1,3,4,5,7,8,10],_=[2,9,11],D=[1,3,4,5,7,8,10,11],P=[1,3,4,5,7,8];function I(o){return function(e,t){for(var n,r=t?e:e.parentNode;r;){if(n=r.nodeType,i(o,n))return r;r=r.parentNode}return null}}var M=I([9,11]),B=I([5,6,10,12]),H=I([6,10,12]);function k(e,t){if(H(e,t))throw new c("INVALID_NODE_TYPE_ERR")}function W(e,t){if(!i(t,e.nodeType))throw new c("INVALID_NODE_TYPE_ERR")}function L(e,t){if(t<0||t>(d(e)?e.length:e.childNodes.length))throw new c("INDEX_SIZE_ERR")}function F(e,t){if(M(e,!0)!==M(t,!0))throw new c("WRONG_DOCUMENT_ERR")}function z(e){if(B(e,!0))throw new c("NO_MODIFICATION_ALLOWED_ERR")}function j(e,t){if(!e)throw new c(t)}function $(e,t){return t<=(d(e)?e.length:e.childNodes.length)}function q(e){return!!e.startContainer&&!!e.endContainer&&!(n&&(s.isBrokenNode(e.startContainer)||s.isBrokenNode(e.endContainer)))&&m(e.startContainer)==m(e.endContainer)&&$(e.startContainer,e.startOffset)&&$(e.endContainer,e.endOffset)}function U(e){if(!q(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var V=document.createElement("style"),Y=!1;try{V.innerHTML="<b>x</b>",Y=3==V.firstChild.nodeType}catch(e){}var G=(a.features.htmlParsingConforms=Y)?function(e){var t=this.startContainer,n=o(t);if(!t)throw new c("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:d(t)&&(r=s.parentElement(t)),(r=null===r||"HTML"==r.nodeName&&s.isHtmlNamespace(o(r).documentElement)&&s.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1)).innerHTML=e,s.fragmentFromNodeChildren(r)}:function(e){var t=C(this).createElement("body");return t.innerHTML=e,s.fragmentFromNodeChildren(t)};function Q(e,t){U(e);var n=e.startContainer,r=e.startOffset,o=e.endContainer,i=e.endOffset,a=n===o;d(o)&&0<i&&i<o.length&&u(o,i,t),d(n)&&0<r&&r<n.length&&(n=u(n,r,t),a?(i-=r,o=n):o==n.parentNode&&i>=h(n)&&i++,r=0),e.setStartAndEnd(n,r,o,i)}function X(e){U(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}var Z=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],J=0,K=1,ee=2,te=3,ne=0,re=1,oe=2,ie=3;function ae(e){e.START_TO_START=J,e.START_TO_END=K,e.END_TO_END=ee,e.END_TO_START=te,e.NODE_BEFORE=ne,e.NODE_AFTER=re,e.NODE_BEFORE_AND_AFTER=oe,e.NODE_INSIDE=ie}function se(e){ae(e),ae(e.prototype)}function ce(a,s){return function(){U(this);var e,t=this.startContainer,n=this.startOffset,r=this.commonAncestorContainer,o=new b(this,!0);t!==r&&(t=(e=E(g(t,r,!0))).node,n=e.offset),T(o,z),o.reset();var i=a(o);return o.detach(),s(this,t,n,t,n),i}}function le(e,u){function t(n,r){return function(e){W(e,O),W(m(e),_);var t=(n?N:E)(e);(r?o:i)(this,t.node,t.offset)}}function o(e,t,n){var r=e.endContainer,o=e.endOffset;t===e.startContainer&&n===e.startOffset||(m(t)==m(r)&&1!=f(t,n,r,o)||(r=t,o=n),u(e,t,n,r,o))}function i(e,t,n){var r=e.startContainer,o=e.startOffset;t===e.endContainer&&n===e.endOffset||(m(t)==m(r)&&-1!=f(t,n,r,o)||(r=t,o=n),u(e,r,o,t,n))}function n(){}n.prototype=a.rangePrototype,e.prototype=new n,r.extend(e.prototype,{setStart:function(e,t){k(e,!0),L(e,t),o(this,e,t)},setEnd:function(e,t){k(e,!0),L(e,t),i(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],r=t,o=n;switch(e.length){case 3:o=e[2];break;case 4:r=e[2],o=e[3]}u(this,t,n,r,o)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:t(!0,!0),setStartAfter:t(!1,!0),setEndBefore:t(!0,!1),setEndAfter:t(!1,!1),collapse:function(e){U(this),e?u(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):u(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){k(e,!0),u(this,e,0,e,p(e))},selectNode:function(e){k(e,!1),W(e,O);var t=N(e),n=E(e);u(this,t.node,t.offset,n.node,n.offset)},extractContents:ce(A,u),deleteContents:ce(w,u),canSurroundContents:function(){U(this),z(this.startContainer),z(this.endContainer);var e=new b(this,!0),t=e._first&&R(e._first,this)||e._last&&R(e._last,this);return e.detach(),!t},splitBoundaries:function(){Q(this)},splitBoundariesPreservingPositions:function(e){Q(this,e)},normalizeBoundaries:function(){U(this);function e(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(s=(a=e).length,e.appendData(t.data),v(t))}function t(e){var t=e.previousSibling;if(t&&t.nodeType==e.nodeType){var n=(o=e).length;if(i=t.length,e.insertData(0,t.data),v(t),o==a)s+=i,a=o;else if(a==e.parentNode){var r=h(e);s==r?(a=e,s=n):r<s&&s--}}}var n,o=this.startContainer,i=this.startOffset,a=this.endContainer,s=this.endOffset,r=!0;if(d(a))s==a.length?e(a):0==s&&(n=a.previousSibling)&&n.nodeType==a.nodeType&&(s=n.length,o==a&&(r=!1),n.appendData(a.data),v(a),a=n);else{if(0<s){var c=a.childNodes[s-1];c&&d(c)&&e(c)}r=!this.collapsed}if(r){if(d(o))0==i?t(o):i==o.length&&(n=o.nextSibling)&&n.nodeType==o.nodeType&&(a==n&&(s+=(a=o).length),o.appendData(n.data),v(n));else if(i<o.childNodes.length){var l=o.childNodes[i];l&&d(l)&&t(l)}}else o=a,i=s;u(this,o,i,a,s)},collapseToPoint:function(e,t){k(e,!0),L(e,t),this.setStartAndEnd(e,t)}}),se(e)}function ue(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:s.getCommonAncestor(e.startContainer,e.endContainer)}function de(e,t,n,r,o){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=o,e.document=s.getDocument(t),ue(e)}function he(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,ue(this)}r.extend(a.rangePrototype,{compareBoundaryPoints:function(e,t){var n,r,o,i;U(this),F(this.startContainer,t.startContainer);var a=e==te||e==J?"start":"end",s=e==K||e==J?"start":"end";return n=this[a+"Container"],r=this[a+"Offset"],o=t[s+"Container"],i=t[s+"Offset"],f(n,r,o,i)},insertNode:function(e){if(U(this),W(e,D),z(this.startContainer),l(e,this.startContainer))throw new c("HIERARCHY_REQUEST_ERR");var t=y(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var e,t;if(U(this),this.collapsed)return C(this).createDocumentFragment();if(this.startContainer===this.endContainer&&d(this.startContainer))return(e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(t=C(this).createDocumentFragment()).appendChild(e),t;var n=new b(this,!0);return e=function e(t){for(var n,r,o,i=C(t.range).createDocumentFragment();r=t.next();){if(n=t.isPartiallySelectedSubtree(),r=r.cloneNode(!n),n&&(o=t.getSubtreeIterator(),r.appendChild(e(o)),o.detach()),10==r.nodeType)throw new c("HIERARCHY_REQUEST_ERR");i.appendChild(r)}return i}(n),n.detach(),e},canSurroundContents:function(){U(this),z(this.startContainer),z(this.endContainer);var e=new b(this,!0),t=e._first&&R(e._first,this)||e._last&&R(e._last,this);return e.detach(),!t},surroundContents:function(e){if(W(e,P),!this.canSurroundContents())throw new c("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);y(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){U(this);for(var e,t=new he(C(this)),n=Z.length;n--;)t[e=Z[n]]=this[e];return t},toString:function(){U(this);var e=this.startContainer;if(e===this.endContainer&&d(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new b(this,!0);return T(n,function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){U(this);var t=e.parentNode,n=h(e);if(!t)throw new c("NOT_FOUND_ERR");var r=this.comparePoint(t,n),o=this.comparePoint(t,n+1);return r<0?0<o?oe:ne:0<o?re:ie},comparePoint:function(e,t){return U(this),j(e,"HIERARCHY_REQUEST_ERR"),F(e,this.startContainer),f(e,t,this.startContainer,this.startOffset)<0?-1:0<f(e,t,this.endContainer,this.endOffset)?1:0},createContextualFragment:G,toHtml:function(){return X(this)},intersectsNode:function(e,t){if(U(this),m(e)!=function(e){return m(e.startContainer)}(this))return!1;var n=e.parentNode,r=h(e);if(!n)return!0;var o=f(n,r,this.endContainer,this.endOffset),i=f(n,r+1,this.startContainer,this.startOffset);return t?o<=0&&0<=i:o<0&&0<i},isPointInRange:function(e,t){return U(this),j(e,"HIERARCHY_REQUEST_ERR"),F(e,this.startContainer),0<=f(e,t,this.startContainer,this.startOffset)&&f(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return S(this,e,!1)},intersectsOrTouchesRange:function(e){return S(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=f(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=f(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==f(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==f(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new c("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ie},containsNodeContents:function(e){return 0<=this.comparePoint(e,0)&&this.comparePoint(e,p(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(0<n.length){t.setStart(n[0],0);var r=n.pop();return t.setEnd(r,r.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return U(this),function(r,e,o){var i,a=!(!e||!e.length),s=!!o;a&&(i=new RegExp("^("+e.join("|")+")$"));var c=[];return T(new b(r,!1),function(e){if((!a||i.test(e.nodeType))&&(!s||o(e))){var t=r.startContainer;if(e!=t||!d(t)||r.startOffset!=t.length){var n=r.endContainer;e==n&&d(n)&&0==r.endOffset||c.push(e)}}}),c}(this,e,t)},getDocument:function(){return C(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(e){var t=C(this),n=a.createRange(t);e=e||s.getBody(t),n.selectNodeContents(e);var r=this.intersection(n),o=0,i=0;return r&&(n.setEnd(r.startContainer,r.startOffset),i=(o=n.toString().length)+r.toString().length),{start:o,end:i,containerNode:e}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var r,o,i,a,s=[t],c=!1,l=!1;!l&&(r=s.pop());)if(3===r.nodeType)o=n+r.length,!c&&e.start>=n&&e.start<=o&&(this.setStart(r,e.start-n),c=!0),c&&e.end>=n&&e.end<=o&&(this.setEnd(r,e.end-n),l=!0),n=o;else for(i=(a=r.childNodes).length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(e){return he.rangesEqual(this,e)},isValid:function(){return q(this)},inspect:function(){return x(this)},detach:function(){}}),le(he,de),r.extend(he,{rangeProperties:Z,RangeIterator:b,copyComparisonConstants:se,createPrototypeRange:le,inspect:x,toHtml:X,getRangeDocument:C,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),a.DomRange=he}),x.createCoreModule("WrappedRange",["DomRange"],function(u,d){var h,e,y=u.dom,f=u.util,S=y.DomPosition,g=u.DomRange,p=y.getBody,m=y.getContentDocument,T=y.isCharacterDataNode;if(u.features.implementsDomRange&&function(){var t,n,r=g.rangeProperties;function o(e){for(var t,n=r.length;n--;)e[t=r[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}h=function(e){if(!e)throw d.createError("WrappedRange: Range must be specified");this.nativeRange=e,o(this)},g.createPrototypeRange(h,function(e,t,n,r,o){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==r||e.endOffset!=o,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(r,o),e.setStart(t,n))}),(t=h.prototype).selectNode=function(e){this.nativeRange.selectNode(e),o(this)},t.cloneContents=function(){return this.nativeRange.cloneContents()},t.surroundContents=function(e){this.nativeRange.surroundContents(e),o(this)},t.collapse=function(e){this.nativeRange.collapse(e),o(this)},t.cloneRange=function(){return new h(this.nativeRange.cloneRange())},t.refresh=function(){o(this)},t.toString=function(){return this.nativeRange.toString()};var e=document.createTextNode("test");p(document).appendChild(e);var i=document.createRange();i.setStart(e,0),i.setEnd(e,0);try{i.setStart(e,1),t.setStart=function(e,t){this.nativeRange.setStart(e,t),o(this)},t.setEnd=function(e,t){this.nativeRange.setEnd(e,t),o(this)},n=function(t){return function(e){this.nativeRange[t](e),o(this)}}}catch(e){t.setStart=function(t,n){try{this.nativeRange.setStart(t,n)}catch(e){this.nativeRange.setEnd(t,n),this.nativeRange.setStart(t,n)}o(this)},t.setEnd=function(t,n){try{this.nativeRange.setEnd(t,n)}catch(e){this.nativeRange.setStart(t,n),this.nativeRange.setEnd(t,n)}o(this)},n=function(n,r){return function(t){try{this.nativeRange[n](t)}catch(e){this.nativeRange[r](t),this.nativeRange[n](t)}o(this)}}}t.setStartBefore=n("setStartBefore","setEndBefore"),t.setStartAfter=n("setStartAfter","setEndAfter"),t.setEndBefore=n("setEndBefore","setStartBefore"),t.setEndAfter=n("setEndAfter","setStartAfter"),t.selectNodeContents=function(e){this.setStartAndEnd(e,0,y.getNodeLength(e))},i.selectNodeContents(e),i.setEnd(e,3);var a=document.createRange();a.selectNodeContents(e),a.setEnd(e,4),a.setStart(e,2),-1==i.compareBoundaryPoints(i.START_TO_END,a)&&1==i.compareBoundaryPoints(i.END_TO_START,a)?t.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:t.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var s=document.createElement("div");s.innerHTML="123";var c=s.firstChild,l=p(document);l.appendChild(s),i.setStart(c,1),i.setEnd(c,2),i.deleteContents(),"13"==c.data&&(t.deleteContents=function(){this.nativeRange.deleteContents(),o(this)},t.extractContents=function(){var e=this.nativeRange.extractContents();return o(this),e}),l.removeChild(s),l=null,f.isHostMethod(i,"createContextualFragment")&&(t.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),p(document).removeChild(e),t.getName=function(){return"WrappedRange"},u.WrappedRange=h,u.createNativeRange=function(e){return(e=m(e,d,"createNativeRange")).createRange()}}(),u.features.implementsTextRange){var o=function(e,t,n,r,o){var i=e.duplicate();i.collapse(n);var a=i.parentElement();if(y.isOrIsAncestorOf(t,a)||(a=t),!a.canHaveHTML){var s=new S(a.parentNode,y.getNodeIndex(a));return{boundaryPosition:s,nodeInfo:{nodeIndex:s.offset,containerElement:s.node}}}var c=y.getDocument(a).createElement("span");c.parentNode&&y.removeNode(c);for(var l,u,d,h,f,g=n?"StartToStart":"StartToEnd",p=o&&o.containerElement==a?o.nodeIndex:0,m=a.childNodes.length,v=m,R=v;R==m?a.appendChild(c):a.insertBefore(c,a.childNodes[R]),i.moveToElementText(c),0!=(l=i.compareEndPoints(g,e))&&p!=v;){if(-1==l){if(v==p+1)break;p=R}else v=v==p+1?p:R;R=Math.floor((p+v)/2),a.removeChild(c)}if(f=c.nextSibling,-1==l&&f&&T(f)){var C;if(i.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(f.data)){var N=i.duplicate(),E=N.text.replace(/\r\n/g,"\r").length;for(C=N.moveStart("character",E);-1==(l=N.compareEndPoints("StartToEnd",N));)C++,N.moveStart("character",1)}else C=i.text.length;h=new S(f,C)}else u=(r||!n)&&c.previousSibling,h=(d=(r||n)&&c.nextSibling)&&T(d)?new S(d,0):u&&T(u)?new S(u,u.data.length):new S(a,y.getNodeIndex(c));return y.removeNode(c),{boundaryPosition:h,nodeInfo:{nodeIndex:R,containerElement:a}}},i=function(e,t){var n,r,o,i,a=e.offset,s=y.getDocument(e.node),c=p(s).createTextRange(),l=T(e.node);return r=l?(n=e.node).parentNode:(n=a<(i=e.node.childNodes).length?i[a]:null,e.node),(o=s.createElement("span")).innerHTML="&#feff;",n?r.insertBefore(o,n):r.appendChild(o),c.moveToElementText(o),c.collapse(!t),r.removeChild(o),l&&c[t?"moveStart":"moveEnd"]("character",a),c};((e=function(e){this.textRange=e,this.refresh()}).prototype=new g(document)).refresh=function(){var e,t,n,r=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();(n=e.duplicate()).collapse(!1);var o=n.parentElement(),i=r==o?r:y.getCommonAncestor(r,o);return i==t?i:y.getCommonAncestor(t,i)}(this.textRange);t=function(e){return 0==e.compareEndPoints("StartToEnd",e)}(this.textRange)?e=o(this.textRange,r,!0,!0).boundaryPosition:(e=(n=o(this.textRange,r,!0,!1)).boundaryPosition,o(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},e.prototype.getName=function(){return"WrappedTextRange"},g.copyComparisonConstants(e);var t=function(e){if(e.collapsed)return i(new S(e.startContainer,e.startOffset),!0);var t=i(new S(e.startContainer,e.startOffset),!0),n=i(new S(e.endContainer,e.endOffset),!1),r=p(g.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r};if(e.rangeToTextRange=t,e.prototype.toTextRange=function(){return t(this)},u.WrappedTextRange=e,!u.features.implementsDomRange||u.config.preferTextRange){var n=Function("return this;")();void 0===n.Range&&(n.Range=e),u.createNativeRange=function(e){return e=m(e,d,"createNativeRange"),p(e).createTextRange()},u.WrappedRange=e}}u.createRange=function(e){return e=m(e,d,"createRange"),new u.WrappedRange(u.createNativeRange(e))},u.createRangyRange=function(e){return e=m(e,d,"createRangyRange"),new g(e)},f.createAliasForDeprecatedMethod(u,"createIframeRange","createRange"),f.createAliasForDeprecatedMethod(u,"createIframeRangyRange","createRangyRange"),u.addShimListener(function(e){var t=e.document;void 0===t.createRange&&(t.createRange=function(){return u.createRange(t)}),t=e=null})}),x.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(d,c){d.config.checkSelectionRanges=!0;var o,i,e="boolean",t="number",h=d.dom,n=d.util,r=n.isHostMethod,s=d.DomRange,a=d.WrappedRange,l=d.DOMException,u=h.DomPosition,f=d.features,g="Control",p=h.getDocument,m=h.getBody,v=s.rangesEqual;function R(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function C(e,t){if(e){if(h.isWindow(e))return e;if(e instanceof U)return e.win;var n=h.getContentDocument(e,c,t);return h.getWindow(n)}return window}function N(e){return C(e,"getDocSelection").document.selection}function E(e){var t=!1;return e.anchorNode&&(t=1==h.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}var y=r(window,"getSelection"),S=n.isHostObject(document,"selection");f.implementsWinGetSelection=y;var T=(f.implementsDocSelection=S)&&(!y||d.config.preferTextRange);if(T)o=N,d.isSelectionValid=function(e){var t=C(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||p(n.createRange().parentElement())==t};else{if(!y)return c.fail("Neither document.selection or window.getSelection() detected."),!1;o=function(e){return C(e,"getWinSelection").getSelection()},d.isSelectionValid=function(){return!0}}var w=(d.getNativeSelection=o)();if(!w)return c.fail("Native selection was null (possibly issue 138?)"),!1;var A=d.createNativeRange(document),x=m(document),b=n.areHostProperties(w,["anchorNode","focusNode","anchorOffset","focusOffset"]);f.selectionHasAnchorAndFocus=b;var O=r(w,"extend");f.selectionHasExtend=O;var _=ie()(w.rangeCount)==t;f.selectionHasRangeCount=_;var D=!1,P=!0,I=O?function(e,t){var n=s.getRangeDocument(t),r=d.createRange(n);r.collapseToPoint(t.endContainer,t.endOffset),e.addRange(L(r)),e.extend(t.startContainer,t.startOffset)}:null;n.areHostMethods(w,["addRange","getRangeAt","removeAllRanges"])&&ie()(w.rangeCount)==t&&f.implementsDomRange&&function(){var e=window.getSelection();if(e){for(var t=e.rangeCount,n=1<t,r=[],o=E(e),i=0;i<t;++i)r[i]=e.getRangeAt(i);var a=h.createTestElement(document,"",!1),s=a.appendChild(document.createTextNode("   ")),c=document.createRange();if(c.setStart(s,1),c.collapse(!0),e.removeAllRanges(),e.addRange(c),P=1==e.rangeCount,e.removeAllRanges(),!n){var l=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(l&&36<=parseInt(l[1]))D=!1;else{var u=c.cloneRange();c.setStart(s,0),u.setEnd(s,3),u.setStart(s,2),e.addRange(c),e.addRange(u),D=2==e.rangeCount}}for(h.removeNode(a),e.removeAllRanges(),i=0;i<t;++i)0==i&&o?I?I(e,r[i]):(d.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),e.addRange(r[i])):e.addRange(r[i])}}(),f.selectionSupportsMultipleRanges=D,f.collapsedNonEditableSelectionsSupported=P;var M,B,H=!1;function k(e,t,n){var r=n?"end":"start",o=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function W(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function L(e){var t;return e instanceof s?((t=d.createNativeRange(e.getDocument())).setEnd(e.endContainer,e.endOffset),t.setStart(e.startContainer,e.startOffset)):e instanceof a?t=e.nativeRange:f.implementsDomRange&&e instanceof h.getWindow(e.startContainer).Range&&(t=e),t}function F(e){var t=e.getNodes();if(!function(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;t<n;++t)if(!h.isAncestorOf(e[0],e[t]))return!1;return!0}(t))throw c.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function z(e){return!!e&&void 0!==e.text}function j(e,t){var n=new a(t);e._ranges=[n],k(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function $(e){if(e._ranges.length=0,"None"==e.docSelection.type)W(e);else{var t=e.docSelection.createRange();if(z(t))j(e,t);else{e.rangeCount=t.length;for(var n,r=p(t.item(0)),o=0;o<e.rangeCount;++o)(n=d.createRange(r)).selectNode(t.item(o)),e._ranges.push(n);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed,k(e,e._ranges[e.rangeCount-1],!1)}}}function q(e,t){for(var n=e.docSelection.createRange(),r=F(t),o=p(n.item(0)),i=m(o).createControlRange(),a=0,s=n.length;a<s;++a)i.add(n.item(a));try{i.add(r)}catch(e){throw c.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}i.select(),$(e)}function U(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function V(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}x&&r(x,"createControlRange")&&(M=x.createControlRange(),n.areHostProperties(M,["item","add"])&&(H=!0)),f.implementsControlRange=H,i=b?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},r(w,"getRangeAt")?B=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:b&&(B=function(e){var t=p(e.anchorNode),n=d.createRange(t);return n.setStartAndEnd(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),n.collapsed!==this.isCollapsed&&n.setStartAndEnd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset),n}),U.prototype=d.selectionPrototype;var Y=[];function G(e,t){for(var n,r,o=Y.length;o--;)if(r=(n=Y[o]).selection,"deleteAll"==t)V(r);else if(n.win==e)return"delete"==t?(Y.splice(o,1),!0):r;return"deleteAll"==t&&(Y.length=0),null}function Q(e){if(e&&e instanceof U)return e.refresh(),e;var t=G(e=C(e,"getNativeSelection")),n=o(e),r=S?N(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh()):(t=new U(n,r,e),Y.push({win:e,selection:t})),t}d.getSelection=Q,n.createAliasForDeprecatedMethod(d,"getIframeSelection","getSelection");var X,Z=U.prototype;function J(e,t){for(var n,r=p(t[0].startContainer),o=m(r).createControlRange(),i=0,a=t.length;i<a;++i){n=F(t[i]);try{o.add(n)}catch(e){throw c.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select(),$(e)}if(!T&&b&&n.areHostMethods(w,["removeAllRanges","addRange"])){Z.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),W(this)};var K=function(e,t){I(e.nativeSelection,t),e.refresh()};Z.addRange=_?function(e,t){if(H&&S&&this.docSelection.type==g)q(this,e);else if(R(t)&&O)K(this,e);else{var n;n=D?this.rangeCount:(this.removeAllRanges(),0);var r=L(e).cloneRange();try{this.nativeSelection.addRange(r)}catch(e){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==n+1){if(d.config.checkSelectionRanges){var o=B(this.nativeSelection,this.rangeCount-1);o&&!v(o,e)&&(e=new a(o))}this._ranges[this.rangeCount-1]=e,k(this,e,te(this.nativeSelection)),this.isCollapsed=i(this)}else this.refresh()}}:function(e,t){R(t)&&O?K(this,e):(this.nativeSelection.addRange(L(e)),this.refresh())},Z.setRanges=function(e){if(H&&S&&1<e.length)J(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(r(w,"empty")&&r(A,"select")&&H&&T))return c.fail("No means of selecting a Range or TextRange was found"),!1;Z.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=p(this.anchorNode);else if(this.docSelection.type==g){var t=this.docSelection.createRange();t.length&&(e=p(t.item(0)))}if(e)m(e).createTextRange().select(),this.docSelection.empty()}}catch(e){}W(this)},Z.addRange=function(e){this.docSelection.type==g?q(this,e):(d.WrappedTextRange.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,k(this,e,!1))},Z.setRanges=function(e){this.removeAllRanges();var t=e.length;1<t?J(this,e):t&&this.addRange(e[0])}}if(Z.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new l("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},T)X=function(e){var t;d.isSelectionValid(e.win)?t=e.docSelection.createRange():(t=m(e.win.document).createTextRange()).collapse(!0),e.docSelection.type==g?$(e):z(t)?j(e,t):W(e)};else if(r(w,"getRangeAt")&&ie()(w.rangeCount)==t)X=function(e){if(H&&S&&e.docSelection.type==g)$(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount,e.rangeCount){for(var t=0,n=e.rangeCount;t<n;++t)e._ranges[t]=new d.WrappedRange(e.nativeSelection.getRangeAt(t));k(e,e._ranges[e.rangeCount-1],te(e.nativeSelection)),e.isCollapsed=i(e)}else W(e)};else{if(!b||ie()(w.isCollapsed)!=e||ie()(A.collapsed)!=e||!f.implementsDomRange)return c.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;X=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=B(n,0),e._ranges=[t],e.rangeCount=1,function(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}(e),e.isCollapsed=i(e)):W(e)}}Z.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;if(X(this),e){var o=t.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;for(;o--;)if(!v(t[o],this._ranges[o]))return!0;return!1}};function ee(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,o=n.length;r<o;++r)v(t,n[r])||e.addRange(n[r]);e.rangeCount||W(e)}var te;function ne(e,t){if(e.win.document!=p(t))throw new l("WRONG_DOCUMENT_ERR")}function re(r){return function(e,t){var n;this.rangeCount?(n=this.getRangeAt(0))["set"+(r?"Start":"End")](e,t):(n=d.createRange(this.win.document)).setStartAndEnd(e,t),this.setSingleRange(n,this.isBackward())}}function oe(e){var t=[],n=new u(e.anchorNode,e.anchorOffset),r=new u(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var i=0,a=e.rangeCount;i<a;++i)t[i]=s.inspect(e.getRangeAt(i));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}Z.removeRange=H&&S?function(e){if(this.docSelection.type==g){for(var t=this.docSelection.createRange(),n=F(e),r=p(t.item(0)),o=m(r).createControlRange(),i=!1,a=0,s=t.length;a<s;++a)t.item(a)!==n||i?o.add(t.item(a)):i=!0;o.select(),$(this)}else ee(this,e)}:function(e){ee(this,e)},!T&&b&&f.implementsDomRange?(te=E,Z.isBackward=function(){return te(this)}):te=Z.isBackward=function(){return!1},Z.isBackwards=Z.isBackward,Z.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},Z.collapse=function(e,t){ne(this,e);var n=d.createRange(e);n.collapseToPoint(e,t),this.setSingleRange(n),this.isCollapsed=!0},Z.collapseToStart=function(){if(!this.rangeCount)throw new l("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},Z.collapseToEnd=function(){if(!this.rangeCount)throw new l("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},Z.selectAllChildren=function(e){ne(this,e);var t=d.createRange(e);t.selectNodeContents(e),this.setSingleRange(t)},Z.deleteFromDocument=function(){if(H&&S&&this.docSelection.type==g){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),h.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,o=n.length;r<o;++r)n[r].deleteContents();this.addRange(n[o-1])}}},Z.eachRange=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(e(this.getRangeAt(n)))return t},Z.getAllRanges=function(){var t=[];return this.eachRange(function(e){t.push(e)}),t},Z.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},Z.callMethodOnEachRange=function(t,n){var r=[];return this.eachRange(function(e){r.push(e[t].apply(e,n||[]))}),r},Z.setStart=re(!0),Z.setEnd=re(!1),d.rangePrototype.select=function(e){Q(this.getDocument()).setSingleRange(this,e)},Z.changeEachRange=function(t){var n=[],e=this.isBackward();this.eachRange(function(e){t(e),n.push(e)}),this.removeAllRanges(),e&&1==n.length?this.addRange(n[0],"backward"):this.setRanges(n)},Z.containsNode=function(t,n){return this.eachRange(function(e){return e.containsNode(t,n)},!0)||!1},Z.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},Z.moveToBookmark=function(e){for(var t,n,r=[],o=0;t=e.rangeBookmarks[o++];)(n=d.createRange(this.win)).moveToBookmark(t),r.push(n);e.backward?this.setSingleRange(r[0],"backward"):this.setRanges(r)},Z.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},Z.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},Z.toHtml=function(){var t=[];return this.eachRange(function(e){t.push(s.toHtml(e))}),t.join("")},f.implementsTextRange&&(Z.getNativeTextRange=function(){var e;if(e=this.docSelection){var t=e.createRange();if(z(t))return t;throw c.createError("getNativeTextRange: selection is a control selection")}if(0<this.rangeCount)return d.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw c.createError("getNativeTextRange: selection contains no range")}),Z.getName=function(){return"WrappedSelection"},Z.inspect=function(){return oe(this)},Z.detach=function(){G(this.win,"delete"),V(this)},U.detachAll=function(){G(null,"deleteAll")},U.inspect=oe,U.isDirectionBackward=R,d.Selection=U,d.selectionPrototype=Z,d.addShimListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return Q(e)}),e=null})});function F(e){z||(z=!0,!x.initialized&&x.config.autoInitialize&&I())}var z=!1;w&&("complete"==document.readyState?F():(h(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",F,!1),y(window,"load",F)));var j,$=x;$.createModule("ClassApplier",["WrappedSelection"],function(r,d){var h=r.dom,o=h.DomPosition,i=h.arrayContains,e=r.util,m=e.forEach,a=e.isHostMethod(document,"createElementNS");function f(e,t){for(var n in e)if(e.hasOwnProperty(n)&&!1===t(n,e[n]))return!1;return!0}function g(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function s(e,t){return!!e&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e)}function c(e,t){return"object"===ie()(e.classList)?e.classList.contains(t):s("string"==typeof e.className?e.className:e.getAttribute("class"),t)}function p(e,t){if("object"==ie()(e.classList))e.classList.add(t);else{var n="string"==typeof e.className,r=n?e.className:e.getAttribute("class");r?s(r,t)||(r+=" "+t):r=t,n?e.className=r:e.setAttribute("class",r)}}var v=function(e,t){if("object"===ie()(e.classList))e.classList.remove(t);else{var n="string"==typeof e.className,r=n?e.className:e.getAttribute("class");r=r.replace(new RegExp("(^|\\s)"+t+"(\\s|$)"),l),n?e.className=r:e.setAttribute("class",r)}};function l(e,t,n){return t&&n?" ":""}function t(e){return"string"==typeof e.className?e.className:e.getAttribute("class")}function R(e){return e&&e.split(/\s+/).sort().join(" ")}function n(e){return R(t(e))}function u(e,t){return n(e)===n(t)}function C(e,t){for(var n=t.split(/\s+/),r=0,o=n.length;r<o;++r)if(!c(e,g(n[r])))return!1;return!0}function N(e,t,n,r){-1===n&&(n=t.childNodes.length);var o=e.parentNode,i=h.getNodeIndex(e);m(r,function(e){!function(e,t,n,r,o){var i=e.node,a=e.offset,s=i,c=a;i===r&&o<a&&++c,i!==t||a!==n&&a!==n+1||(s=r,c+=o-n),i===t&&n+1<a&&--c,e.node=s,e.offset=c}(e,o,i,t,n)}),t.childNodes.length==n?t.appendChild(e):t.insertBefore(e,t.childNodes[n])}function E(e,t){var n=e.parentNode,r=h.getNodeIndex(e);m(t,function(e){!function(e,t,n){e.node===t&&e.offset>n&&--e.offset}(e,n,r)}),h.removeNode(e)}function y(e,t){return function(e,t,n,r,o){for(var i,a=[];i=e.firstChild;)N(i,t,n++,o),a.push(i);return r&&E(e,o),a}(e,e.parentNode,h.getNodeIndex(e),!0,t)}function S(e,t){var n=e.cloneRange();n.selectNodeContents(t);var r=n.intersection(e);return""!=(r?r.toString():"")}function T(e){for(var t,n=e.getNodes([3]),r=0;(t=n[r])&&!S(e,t);)++r;for(var o=n.length-1;(t=n[o])&&!S(e,t);)--o;return n.slice(r,o+1)}function w(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,r,o,i=0,a=e.attributes.length;i<a;++i)if("class"!=(o=(n=e.attributes[i]).name)){if(null===n!=(null===(r=t.attributes.getNamedItem(o))))return!1;if(n.specified!=r.specified)return!1;if(n.specified&&n.nodeValue!==r.nodeValue)return!1}return!0}function A(e,t){for(var n,r=0,o=e.attributes.length;r<o;++r)if(n=e.attributes[r].name,(!t||!i(t,n))&&e.attributes[r].specified&&"class"!=n)return!0;return!1}var x=h.getComputedStyleProperty,b="boolean"==typeof document.createElement("div").isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return!(!e||1!=e.nodeType||"false"==e.contentEditable)&&("true"==e.contentEditable||b(e.parentNode))};function O(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||b(e)&&!b(e.parentNode))}function _(e){return(b(e)||1!=e.nodeType&&b(e.parentNode))&&!O(e)}var D=/^inline(-block|-table)?$/i;function P(e){return e&&1==e.nodeType&&!D.test(x(e,"display"))}var I=/[^\r\n\t\f \u200B]/;function M(e){var t,n,r=[];for(t=0;n=e[t++];)r.push(new o(n.startContainer,n.startOffset),new o(n.endContainer,n.endOffset));return r}function B(e,t){for(var n,r,o,i=0,a=e.length;i<a;++i)n=e[i],r=t[2*i],o=t[2*i+1],n.setStartAndEnd(r.node,r.offset,o.node,o.offset)}function H(e,t,n,r){var o,i,a=0==n;if(h.isAncestorOf(t,e))return e;if(h.isCharacterDataNode(t)){var s=h.getNodeIndex(t);if(0===n)n=s;else{if(n!==t.length)throw d.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+n+" in "+t.data);n=s+1}t=t.parentNode}if(function(e,t){return h.isCharacterDataNode(e)?0==t?!!e.previousSibling:t!=e.length||!!e.nextSibling:0<t&&t<e.childNodes.length}(t,n)){o=t.cloneNode(!1),i=t.parentNode,o.id&&o.removeAttribute("id");for(var c,l=0;c=t.childNodes[n];)N(c,o,l++,r);return N(o,i,h.getNodeIndex(t)+1,r),t==e?o:H(e,i,h.getNodeIndex(o),r)}if(e==t)return e;o=t.parentNode;var u=h.getNodeIndex(t);return a||u++,H(e,o,u,r)}function k(i){var a=i?"nextSibling":"previousSibling";return function(e,t){var n=e.parentNode,r=e[a];if(r){if(r&&3==r.nodeType)return r}else if(t&&(r=n[a])&&1==r.nodeType&&function(e,t){return e.namespaceURI==t.namespaceURI&&e.tagName.toLowerCase()==t.tagName.toLowerCase()&&u(e,t)&&w(e,t)&&"inline"==x(e,"display")&&"inline"==x(t,"display")}(n,r)){var o=r[i?"firstChild":"lastChild"];if(o&&3==o.nodeType)return o}return null}}var W=k(!1),L=k(!0);function F(e){this.isElementMerge=1==e.nodeType,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}var z=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],j={};function $(e,t,n){var r,o,i,a,s=this;s.cssClass=s.className=e;var c=null,l={};if("object"==ie()(t)&&null!==t){for(void 0!==t.elementTagName&&(t.elementTagName=t.elementTagName.toLowerCase()),n=t.tagNames,c=t.elementProperties,l=t.elementAttributes,o=0;a=z[o++];)t.hasOwnProperty(a)&&(s[a]=t[a]);r=t.normalize}else r=t;s.normalize=void 0===r||r,s.attrExceptions=[];var u=document.createElement(s.elementTagName);s.elementProperties=s.copyPropertiesToElement(c,u,!0),f(l,function(e,t){s.attrExceptions.push(e),l[e]=""+t}),s.elementAttributes=l,s.elementSortedClassName=s.elementProperties.hasOwnProperty("className")?R(s.elementProperties.className+" "+e):e,s.applyToAnyTagName=!1;var d=ie()(n);if("string"===d)"*"===n?s.applyToAnyTagName=!0:s.tagNames=g(n.toLowerCase()).split(/\s*,\s*/);else if("object"===d&&"number"==typeof n.length)for(s.tagNames=[],o=0,i=n.length;o<i;++o)"*"===n[o]?s.applyToAnyTagName=!0:s.tagNames.push(n[o].toLowerCase());else s.tagNames=[s.elementTagName]}$.prototype={elementTagName:"span",elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:(F.prototype={doMerge:function(e){var t=this.textNodes,r=t[0];if(1<t.length){var o,i=h.getNodeIndex(r),a=[],s=0;m(t,function(t,n){o=t.parentNode,0<n&&(o.removeChild(t),o.hasChildNodes()||h.removeNode(o),e&&m(e,function(e){e.node==t&&(e.node=r,e.offset+=s),e.node==o&&e.offset>i&&(--e.offset,e.offset==i+1&&n<len-1&&(e.node=r,e.offset=s))})),a[n]=t.data,s+=t.data.length}),r.data=a.join("")}return r.data},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){var n=[];return m(this.textNodes,function(e,t){n[t]="'"+e.data+"'"}),"[Merge("+n.join(",")+")]"}},!1),useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var r,o,i,a,s,c,l={};for(var u in e)if(e.hasOwnProperty(u))if(a=e[u],s=t[u],"className"===u)p(t,a),p(t,this.className),t[u]=R(t[u]),n&&(l[u]=a);else if("style"==u){for(r in o=s,n&&(l[u]=i={}),e[u])e[u].hasOwnProperty(r)&&(o[r]=a[r],n&&(i[r]=o[r]));this.attrExceptions.push(u)}else t[u]=a,n&&(l[u]=t[u],c=j.hasOwnProperty(u)?j[u]:u,this.attrExceptions.push(c));return n?l:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&!/^class(?:Name)?$/i.test(n)&&t.setAttribute(n,e[n])},appliesToElement:function(e){return i(this.tagNames,e.tagName.toLowerCase())},getEmptyElements:function(e){var t=this;return e.getNodes([1],function(e){return t.appliesToElement(e)&&!e.hasChildNodes()})},hasClass:function(e){return 1===e.nodeType&&(this.applyToAnyTagName||this.appliesToElement(e))&&c(e,this.className)},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||_(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3===e.nodeType&&function(e){if(0==e.data.length)return!0;if(I.test(e.data))return!1;switch(x(e.parentNode,"whiteSpace")){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return P(e.previousSibling)||P(e.nextSibling)}(e)},postApply:function(e,t,n,r){var o,i,a=e[0],s=e[e.length-1],c=[],l=a,u=s,d=0,h=s.length;m(e,function(e){(i=W(e,!r))?(o||(o=new F(i),c.push(o)),o.textNodes.push(e),e===a&&(l=o.textNodes[0],d=l.length),e===s&&(u=o.textNodes[0],h=o.getLength())):o=null});var f=L(s,!r);if(f&&(o||(o=new F(s),c.push(o)),o.textNodes.push(f)),c.length){for(var g=0,p=c.length;g<p;++g)c[g].doMerge(n);t.setStartAndEnd(l,d,u,h)}},createContainer:function(e){var t=h.getDocument(e),n=a&&!h.isHtmlNamespace(e)&&e.namespaceURI?t.createElementNS(e.namespaceURI,this.elementTagName):t.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,n,!1),this.copyAttributesToElement(this.elementAttributes,n),p(n,this.className),this.onElementCreate&&this.onElementCreate(n,this),n},elementHasProperties:function(n,e){var r=this;return f(e,function(e,t){if("className"===e)return C(n,t);if("object"===ie()(t)){if(!r.elementHasProperties(n[e],t))return!1}else if(n[e]!==t)return!1})},elementHasAttributes:function(n,e){return f(e,function(e,t){if(n.getAttribute(e)!==t)return!1})},applyToTextNode:function(e,t){if(function(e){var t=e.parentNode;return t&&1===t.nodeType&&!/^(textarea|style|script|select|iframe)$/i.test(t.nodeName)}(e)){var n=e.parentNode;if(1===n.childNodes.length&&this.useExistingElements&&this.appliesToElement(n)&&this.elementHasProperties(n,this.elementProperties)&&this.elementHasAttributes(n,this.elementAttributes))p(n,this.className);else{var r=e.parentNode,o=this.createContainer(r);r.insertBefore(o,e),o.appendChild(e)}}},isRemovable:function(e){return e.tagName.toLowerCase()===this.elementTagName&&n(e)===this.elementSortedClassName&&this.elementHasProperties(e,this.elementProperties)&&!A(e,this.attrExceptions)&&this.elementHasAttributes(e,this.elementAttributes)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return 1===e.nodeType&&this.isRemovable(e)&&(0===t||1===t&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){var t=this,n=e.getNodes([1],function(e){return t.isEmptyContainer(e)}),r=[e],o=M(r);m(n,function(e){E(e,o)}),B(r,o)},undoToTextNode:function(e,t,n,r){if(!t.containsNode(n)){var o=t.cloneRange();o.selectNode(n),o.isPointInRange(t.endContainer,t.endOffset)&&(H(n,t.endContainer,t.endOffset,r),t.setEndAfter(n)),o.isPointInRange(t.startContainer,t.startOffset)&&(n=H(n,t.startContainer,t.startOffset,r))}this.isRemovable(n)?y(n,r):v(n,this.className)},splitAncestorWithClass:function(e,t,n){var r=this.getSelfOrAncestorWithClass(e);r&&H(r,e,t,n)},undoToAncestor:function(e,t){this.isRemovable(e)?y(e,t):v(e,this.className)},applyToRange:function(e,t){var n=this,r=M((t=t||[])||[]);e.splitBoundariesPreservingPositions(r),n.removeEmptyElements&&n.removeEmptyContainers(e);var o=T(e);if(o.length){m(o,function(e){n.isIgnorableWhiteSpaceNode(e)||n.getSelfOrAncestorWithClass(e)||!n.isModifiable(e)||n.applyToTextNode(e,r)});var i=o[o.length-1];e.setStartAndEnd(o[0],0,i,i.length),n.normalize&&n.postApply(o,e,r,!1),B(t,r)}var a=n.getEmptyElements(e);m(a,function(e){p(e,n.className)})},applyToRanges:function(e){for(var t=e.length;t--;)this.applyToRange(e[t],e);return e},applyToSelection:function(e){var t=r.getSelection(e);t.setRanges(this.applyToRanges(t.getAllRanges()))},undoToRange:function(e,t){var n=this,r=M(t=t||[]);e.splitBoundariesPreservingPositions(r),n.removeEmptyElements&&n.removeEmptyContainers(e,r);var o,i,a=T(e),s=a[a.length-1];if(a.length){n.splitAncestorWithClass(e.endContainer,e.endOffset,r),n.splitAncestorWithClass(e.startContainer,e.startOffset,r);for(var c=0,l=a.length;c<l;++c)o=a[c],(i=n.getSelfOrAncestorWithClass(o))&&n.isModifiable(o)&&n.undoToAncestor(i,r);e.setStartAndEnd(a[0],0,s,s.length),n.normalize&&n.postApply(a,e,r,!0),B(t,r)}var u=n.getEmptyElements(e);m(u,function(e){v(e,n.className)})},undoToRanges:function(e){for(var t=e.length;t--;)this.undoToRange(e[t],e);return e},undoToSelection:function(e){var t=r.getSelection(e),n=r.getSelection(e).getAllRanges();this.undoToRanges(n),t.setRanges(n)},isAppliedToRange:function(e){if(e.collapsed||""==e.toString())return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length)for(var n,r=0;n=t[r++];)if(!this.isIgnorableWhiteSpaceNode(n)&&S(e,n)&&this.isModifiable(n)&&!this.getSelfOrAncestorWithClass(n))return!1;return!0},isAppliedToRanges:function(e){var t=e.length;if(0===t)return!1;for(;t--;)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(e){var t=r.getSelection(e);return this.isAppliedToRanges(t.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var n=[],r=this;return e.getNodes([3],function(e){var t=r.getSelfOrAncestorWithClass(e);t&&!i(n,t)&&n.push(t)}),n},detach:function(){}},$.util={hasClass:c,addClass:p,removeClass:v,getClass:t,hasSameClasses:u,hasAllClasses:C,replaceWithOwnChildren:y,elementsHaveSameNonClassAttributes:w,elementHasNonClassAttributes:A,splitNodeAt:H,isEditableElement:b,isEditingHost:O,isEditable:_},r.CssClassApplier=r.ClassApplier=$,r.createClassApplier=function(e,t,n){return new $(e,t,n)},e.createAliasForDeprecatedMethod(r,"createCssClassApplier","createClassApplier",d)}),$.createModule("Highlighter",["ClassApplier"],function(S,e){var t=S.dom,o=t.arrayContains,c=t.getBody,T=S.util.createOptions,w=S.util.forEach,a=1;function n(e,t){return e.characterRange.start-t.characterRange.start}function p(e,t){return t?e.getElementById(t):c(e)}var r={};function i(e,t){this.type=e,this.converterCreator=t}function s(e,t){r[e]=new i(e,t)}function m(e){var t=r[e];if(t instanceof i)return t.create();throw new Error("Highlighter type '"+e+"' is not valid")}function A(e,t){this.start=e,this.end=t}i.prototype.create=function(){var e=this.converterCreator();return e.type=this.type,e},S.registerHighlighterType=s,A.prototype={intersects:function(e){return this.start<e.end&&this.end>e.start},isContiguousWith:function(e){return this.start==e.end||this.end==e.start},union:function(e){return new A(Math.min(this.start,e.start),Math.max(this.end,e.end))},intersection:function(e){return new A(Math.max(this.start,e.start),Math.min(this.end,e.end))},getComplements:function(e){var t=[];if(this.start>=e.start){if(this.end<=e.end)return[];t.push(new A(e.end,this.end))}else t.push(new A(this.start,Math.min(this.end,e.start))),this.end>e.end&&t.push(new A(e.end,this.end));return t},toString:function(){return"[CharacterRange("+this.start+", "+this.end+")]"}},A.fromCharacterRange=function(e){return new A(e.start,e.end)};var l,u={rangeToCharacterRange:function(e,t){var n=e.getBookmark(t);return new A(n.start,n.end)},characterRangeToRange:function(e,t,n){var r=S.createRange(e);return r.moveToBookmark({start:t.start,end:t.end,containerNode:n}),r},serializeSelection:function(e,t){for(var n=e.getAllRanges(),r=[],o=1==n.length&&e.isBackward(),i=0,a=n.length;i<a;++i)r[i]={characterRange:this.rangeToCharacterRange(n[i],t),backward:o};return r},restoreSelection:function(e,t,n){e.removeAllRanges();for(var r,o,i=e.win.document,a=0,s=t.length;a<s;++a)(o=t[a]).characterRange,r=this.characterRangeToRange(i,o.characterRange,n),e.addRange(r,o.backward)}};function x(e,t,n,r,o,i){o?(this.id=o,a=Math.max(a,o+1)):this.id=a++,this.characterRange=t,this.doc=e,this.classApplier=n,this.converter=r,this.containerElementId=i||null,this.applied=!1}function d(e,t){t=t||"textContent",this.doc=e||document,this.classAppliers={},this.highlights=[],this.converter=m(t)}s("textContent",function(){return u}),s("TextRange",function(){if(!l){var e=S.modules.TextRange;if(!e)throw new Error("TextRange module is missing.");if(!e.supported)throw new Error("TextRange module is present but not supported.");l={rangeToCharacterRange:function(e,t){return A.fromCharacterRange(e.toCharacterRange(t))},characterRangeToRange:function(e,t,n){var r=S.createRange(e);return r.selectCharacters(n,t.start,t.end),r},serializeSelection:function(e,t){return e.saveCharacterRanges(t)},restoreSelection:function(e,t,n){e.restoreCharacterRanges(n,t)}}}return l}),x.prototype={getContainerElement:function(){return p(this.doc,this.containerElementId)},getRange:function(){return this.converter.characterRangeToRange(this.doc,this.characterRange,this.getContainerElement())},fromRange:function(e){this.characterRange=this.converter.rangeToCharacterRange(e,this.getContainerElement())},getText:function(){return this.getRange().toString()},containsElement:function(e){return this.getRange().containsNodeContents(e.firstChild)},unapply:function(){this.classApplier.undoToRange(this.getRange()),this.applied=!1},apply:function(){this.classApplier.applyToRange(this.getRange()),this.applied=!0},getHighlightElements:function(){return this.classApplier.getElementsWithClassIntersectingRange(this.getRange())},toString:function(){return"[Highlight(ID: "+this.id+", class: "+this.classApplier.className+", character range: "+this.characterRange.start+" - "+this.characterRange.end+")]"}},d.prototype={addClassApplier:function(e){this.classAppliers[e.className]=e},getHighlightForElement:function(e){for(var t=this.highlights,n=0,r=t.length;n<r;++n)if(t[n].containsElement(e))return t[n];return null},removeHighlights:function(e){for(var t,n=0,r=this.highlights.length;n<r;++n)t=this.highlights[n],o(e,t)&&(t.unapply(),this.highlights.splice(n--,1))},removeAllHighlights:function(){this.removeHighlights(this.highlights)},getIntersectingHighlights:function(e){var n=[],r=this.highlights;return w(e,function(t){w(r,function(e){t.intersectsRange(e.getRange())&&!o(n,e)&&n.push(e)})}),n},highlightCharacterRanges:function(e,t,n){var r,o,i,a,s,c,l,u,d,h,f,g,p=this.highlights,m=this.converter,v=this.doc,R=[],C=e?this.classAppliers[e]:null,N=(n=T(n,{containerElementId:null,exclusive:!0})).containerElementId,E=n.exclusive;for(N&&(a=this.doc.getElementById(N))&&((s=S.createRange(this.doc)).selectNodeContents(a),c=new A(0,s.toString().length)),r=0,o=t.length;r<o;++r)if(l=t[r],f=[],c&&(l=l.intersection(c)),l.start!=l.end){for(i=0;i<p.length;++i)d=!1,N==p[i].containerElementId&&(u=p[i].characterRange,g=!(h=C==p[i].classApplier)&&E,(u.intersects(l)||u.isContiguousWith(l))&&(h||g)&&(g&&w(u.getComplements(l),function(e){f.push(new x(v,e,p[i].classApplier,m,null,N))}),d=!0,h&&(l=u.union(l)))),d?(R.push(p[i]),p[i]=new x(v,u.union(l),C,m,null,N)):f.push(p[i]);C&&f.push(new x(v,l,C,m,null,N)),this.highlights=p=f}w(R,function(e){e.unapply()});var y=[];return w(p,function(e){e.applied||(e.apply(),y.push(e))}),y},highlightRanges:function(e,t,n){var r,o=[],i=this.converter,a=(n=T(n,{containerElement:null,exclusive:!0})).containerElement,s=a?a.id:null;return a&&(r=S.createRange(a)).selectNodeContents(a),w(t,function(e){var t=a?r.intersection(e):e;o.push(i.rangeToCharacterRange(t,a||c(e.getDocument())))}),this.highlightCharacterRanges(e,o,{containerElementId:s,exclusive:n.exclusive})},highlightSelection:function(r,e){var t,o=this,n=this.converter,i=!!r&&this.classAppliers[r],a=(e=T(e,{containerElementId:null,exclusive:!0})).containerElementId,s=e.exclusive,c=e.selection||S.getSelection(this.doc),l=c.win.document;if(t=Array.isArray(a)?p(l,null):p(l,a),!i&&!1!==r)throw new Error("No class applier found for class '"+r+"'");var u=n.serializeSelection(c,t),d=[];w(u,function(e){d.push(A.fromCharacterRange(e.characterRange))});var h=[],f=a;return!1===Array.isArray(f)&&(f=[f]),f.forEach(function(e,t){var n=o.highlightCharacterRanges(r,d,{containerElementId:e,exclusive:s});h=h.concat(n)}),n.restoreSelection(c,u,t),h},unhighlightSelection:function(e){var t=[];e=Array.isArray(e)&&"string"==typeof e[0]?(t=e,S.getSelection(this.doc)):e||S.getSelection(this.doc);var n=this.getIntersectingHighlights(e.getAllRanges());return 0<t.length&&(n=n.filter(function(e){return-1<t.indexOf(e.classApplier.className)})),0<n.length&&this.removeHighlights(n),e.removeAllRanges(),n},getHighlightsInSelection:function(e){return e=e||S.getSelection(this.doc),this.getIntersectingHighlights(e.getAllRanges())},selectionOverlapsHighlight:function(e){return 0<this.getHighlightsInSelection(e).length},serialize:function(o){var e,i,a,s,c=this,t=c.highlights;return t.sort(n),e=(o=T(o,{serializeHighlightText:!1,type:c.converter.type})).type,(a=e!=c.converter.type)&&(s=m(e)),i=["type:"+e],w(t,function(e){var t,n=e.characterRange;a&&(t=e.getContainerElement(),n=s.rangeToCharacterRange(c.converter.characterRangeToRange(c.doc,n,t),t));var r=[n.start,n.end,e.id,e.classApplier.className,e.containerElementId];o.serializeHighlightText&&r.push(e.getText()),i.push(r.join("$"))}),i.join("|")},deserialize:function(e){var t,n,r,o,i,a,s,c,l=e.split("|"),u=[],d=l[0],h=!1;if(!d||!(t=/^type:(\w+)$/.exec(d)))throw new Error("Serialized highlights are invalid.");(n=t[1])!=this.converter.type&&(r=m(n),h=!0),l.shift();for(var f,g=l.length;0<g--;){if(a=new A(+(f=l[g].split("$"))[0],+f[1]),s=f[4]||null,h&&(c=p(this.doc,s),a=this.converter.rangeToCharacterRange(r.characterRangeToRange(this.doc,a,c),c)),!(o=this.classAppliers[f[3]]))throw new Error("No class applier found for class '"+f[3]+"'");(i=new x(this.doc,a,o,this.converter,parseInt(f[2]),s)).apply(),u.push(i)}this.highlights=u}},S.Highlighter=d,S.createHighlighter=function(e,t){return new d(e,t)}}),(j=$).createModule("Position",["WrappedSelection"],function(u,l){var d="number",t="undefined",n=u.WrappedRange,h=u.WrappedTextRange,f=u.dom,e=u.util,g=f.DomPosition;function r(e){var t=0,n=0;if(ie()(e.pageXOffset)==d&&ie()(e.pageYOffset)==d)t=e.pageXOffset,n=e.pageYOffset;else{var r=e.document,o=r.documentElement,i=r.compatMode,a="string"==typeof i&&0<=i.indexOf("CSS")&&o?o:f.getBody(r);if(a&&ie()(a.scrollLeft)==d&&ie()(a.scrollTop)==d)try{t=a.scrollLeft,n=a.scrollTop}catch(e){}}return{x:t,y:n}}function p(e,t){for(t=t.toLowerCase();e;){if(1==e.nodeType&&e.tagName.toLowerCase()==t)return e;e=e.parentNode}return null}function c(e,t,n,r){this.top=e,this.right=t,this.bottom=n,this.left=r,this.width=t-r,this.height=n-e}function m(e,t,n){return new c(e.top+n,e.right+t,e.bottom+n,e.left+t)}function v(e,t){var n=0,r=0,o=t.documentElement,i=f.getBody(t),a=0===o.clientWidth&&ie()(i.clientTop)==d?i:o,s=a.clientLeft,c=a.clientTop;return s&&(n=-s),c&&(r=-c),m(e,n,r)}function R(e){for(var t,n=[],r=[],o=[],i=[],a=0,s=e.length;a<s;++a)(t=e[a])&&(n.push(t.top),r.push(t.bottom),o.push(t.left),i.push(t.right));return new c(Math.min.apply(Math,n),Math.max.apply(Math,i),Math.max.apply(Math,r),Math.min.apply(Math,o))}function o(e,t,n){var r=f.getBody(e).createTextRange();r.moveToPoint(t,n);var o=new u.WrappedTextRange(r);return new g(o.startContainer,o.startOffset)}function i(e,t,n){var r=e.caretPositionFromPoint(t,n);return new g(r.offsetNode,r.offset)}function a(e,t,n){var r=e.caretRangeFromPoint(t,n);return new g(r.startContainer,r.startOffset)}function C(e){var t=(e.nativeRange||e).getClientRects();return 0<t.length?t[t.length-1]:null}function N(e,t,n){return console.log("pointIsInOrAboveRect",e,t,Math.floor(n.top),Math.floor(n.right),Math.floor(n.bottom),Math.floor(n.left)),t<n.bottom&&e>=n.left&&e<=n.right}function s(e,t,n,r){var o=e.elementFromPoint(t,n);console.log("elementFromPoint is ",o);var i=u.createRange(e);i.selectNodeContents(o),i.collapse(!0);var a,s,c,l=o.firstChild;if(l){e:for(;l;){if(3==l.nodeType){for(a=0,c=l.length;a<=c;++a)if(i.setEnd(l,a),(s=C(i))&&N(t,n,s)){s.right-t>t-s.left&&--a;break e}}else if(i.setEndAfter(l),(s=C(i))&&N(t,n,s)){a=f.getNodeIndex(l),l=o.parentNode,r||++a;break}l=l.nextSibling}l||(a=(l=o).childNodes.length)}else l=o.parentNode,a=f.getNodeIndex(o),r||++a;return new g(l,a)}function E(e){if(u.features.implementsTextRange)return o;if(ie()(e.caretPositionFromPoint)!=t)return i;if(ie()(e.caretRangeFromPoint)!=t)return a;if(ie()(e.elementFromPoint)!=t&&w)return s;throw l.createError("createCaretPositionFromPointGetter(): Browser does not provide a recognised method to create a selection from pixel coordinates")}function y(e,t,n,r,o){var i=E(o=f.getContentDocument(o,l,"createRangeFromPoints")),a=i(o,e,t,!1),s=i(o,n,r,!0),c=u.createRange(o);return c.setStartAndEnd(a.node,a.offset,s.node,s.offset),c}var S=document.createElement("span"),T=e.isHostMethod(S,"getBoundingClientRect");S=null;var w=!1,A=!1;if(u.features.implementsDomRange){var x=u.createNativeRange();w=e.isHostMethod(x,"getClientRects"),A=e.isHostMethod(x,"getBoundingClientRect")}e.extend(u.features,{rangeSupportsGetBoundingClientRect:A,rangeSupportsGetClientRects:w,elementSupportsGetBoundingClientRect:T});var b=function(n){return function(){var e=this.cloneRange();e.collapse(n);var t=e.getBoundingClientRect();return{x:t[n?"left":"right"],y:t[n?"top":"bottom"]}}},O=u.rangePrototype;if(u.features.implementsTextRange&&T)O.getBoundingClientRect=function(){var e,t=h.rangeToTextRange(this),n=this.getNodes([1],function(e){return/^t[dh]$/i.test(e.tagName)}),r=[];if(0<n.length){for(var o,i,a,s,c=p(this.startContainer,"table"),l=0;o=n[l];++l)a=p(o,"table"),c&&a==c||(s=this.cloneRange(),c&&s.setStartAfter(c),s.setEndBefore(a),r.push(h.rangeToTextRange(s).getBoundingClientRect())),this.containsNode(o)?r.push(o.getBoundingClientRect()):((i=t.duplicate()).moveToElementText(o),-1==i.compareEndPoints("StartToStart",t)?i.setEndPoint("StartToStart",t):1==i.compareEndPoints("EndToEnd",t)&&i.setEndPoint("EndToEnd",t),r.push(i.getBoundingClientRect())),c=a;!p(this.endContainer,"table")&&c&&((s=this.cloneRange()).setStartAfter(c),r.push(h.rangeToTextRange(s).getBoundingClientRect())),e=R(r)}else e=t.getBoundingClientRect();return v(e,f.getDocument(this.startContainer))};else if(u.features.implementsDomRange){var _=function(e){return e instanceof n?e:new n(e)};if(A)O.getBoundingClientRect=function(){var e=_(this).nativeRange;return v(e.getBoundingClientRect()||e.getClientRects()[0],f.getDocument(this.startContainer))},w&&(b=function(n){return function(){var e,t=_(this).nativeRange.getClientRects();if(0==t.length&&T&&this.collapsed&&1==this.startContainer.nodeType&&this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].getClientRects,0<t.length)return n?{x:(e=t[0]).left,y:e.top}:{x:(e=t[t.length-1]).right,y:e.bottom};throw l.createError("Cannot get position for range "+this.inspect())}});else{var D=T?function(e){return v(e.getBoundingClientRect(),f.getDocument(e))}:function(e){for(var t=0,n=0,r=e,o=e.offsetWidth,i=e.offsetHeight;r;)t+=r.offsetLeft,n+=r.offsetTop,r=r.offsetParent;return v(new c(n,t+o,n+i,t),f.getDocument(e))};O.getBoundingClientRect=function(e){return function(t){var e;t.splitBoundaries();var n=document.createElement("span");if(t.collapsed)t.insertNode(n),e=D(n),n.parentNode.removeChild(n);else{var r=t.cloneRange();r.collapse(!0),r.insertNode(n);var o=D(n);n.parentNode.removeChild(n),r.collapseToPoint(t.endContainer,t.endOffset),r.insertNode(n);var i=D(n);n.parentNode.removeChild(n);for(var a=[o,i],s=t.getNodes([1],function(e){return t.containsNode(e)}),c=0,l=s.length;c<l;++c)a.push(D(s[c]));e=R(a)}return t.normalizeBoundaries(),e}(_(e))}}}function P(n){return function(){var e=this["get"+(n?"Start":"End")+"ClientPos"](),t=r(f.getWindow(this.startContainer));return{x:e.x+t.x,y:e.y+t.y}}}function I(e,t){return e.compareBoundaryPoints(t.START_TO_START,t)}function M(r){return function(){for(var e="getBounding"+(r?"Document":"Client")+"Rect",t=[],n=0;n<this.rangeCount;++n)t.push(this.getRangeAt(n)[e]());return R(t)}}function B(n,r){return function(){if(0==this.rangeCount)return null;var e=r?"Document":"Client",t=this.getAllRanges();return 1<t.length&&t.sort(I),n?t[0]["getStart"+e+"Pos"]():t[t.length-1]["getEnd"+e+"Pos"]()}}e.extend(O,{getBoundingDocumentRect:function(){var e=r(f.getWindow(this.startContainer));return m(this.getBoundingClientRect(),e.x,e.y)},getStartClientPos:b(!0),getEndClientPos:b(!1),getStartDocumentPos:P(!0),getEndDocumentPos:P(!1)}),e.extend(u.selectionPrototype,{getBoundingClientRect:M(!1),getBoundingDocumentRect:M(!0),getStartClientPos:B(!0,!1),getEndClientPos:B(!1,!1),getStartDocumentPos:B(!0,!0),getEndDocumentPos:B(!1,!0)}),u.positionFromPoint=function(e,t,n){return E(n=f.getContentDocument(n,l,"positionFromPoint"))(n,e,t)},u.createRangeFromPoints=y,u.moveSelectionToPoints=function(e,t,n,r,o){var i,a,s,c;c=r<t||t==r&&n<e?(i=n,a=r,s=e,t):(i=e,a=t,s=n,r);var l=j.getSelection(o),u=y(i,a,s,c,o);return l.setSingleRange(u),l}}),$.createModule("SaveRestore",["WrappedRange"],function(c,a){var s=c.dom,l=s.removeNode,u=c.Selection.isDirectionBackward,d="\ufeff";function h(e,t){return(t||document).getElementById(e)}function f(e,t){var n,r="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),o=s.getDocument(e.startContainer),i=e.cloneRange();return i.collapse(t),(n=o.createElement("span")).id=r,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(o.createTextNode(d)),i.insertNode(n),n}function g(e,t,n,r){var o=h(n,e);o?(t[r?"setStartBefore":"setEndBefore"](o),l(o)):a.warn("Marker element has been removed. Cannot restore selection.")}function p(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function m(e,t){var n,r=c.DomRange.getRangeDocument(e),o=e.toString(),i=u(t);return e.collapsed?{document:r,markerId:(n=f(e,!1)).id,collapsed:!0}:(n=f(e,!1),{document:r,startMarkerId:f(e,!0).id,endMarkerId:n.id,collapsed:!1,backward:i,toString:function(){return"original text: '"+o+"', new text: '"+e.toString()+"'"}})}function r(e,t){var n=e.document;void 0===t&&(t=!0);var r=c.createRange(n);if(e.collapsed){var o=h(e.markerId,n);if(o){o.style.display="inline";var i=o.previousSibling;i&&3==i.nodeType?(l(o),r.collapseToPoint(i,i.length)):(r.collapseBefore(o),l(o))}else a.warn("Marker element has been removed. Cannot restore selection.")}else g(n,r,e.startMarkerId,!0),g(n,r,e.endMarkerId,!1);return t&&r.normalizeBoundaries(),r}function i(e,t){var n,r,o=[],i=u(t);(e=e.slice(0)).sort(p);for(var a=0,s=e.length;a<s;++a)o[a]=m(e[a],i);for(a=s-1;0<=a;--a)n=e[a],r=c.DomRange.getRangeDocument(n),n.collapsed?n.collapseAfter(h(o[a].markerId,r)):(n.setEndBefore(h(o[a].endMarkerId,r)),n.setStartAfter(h(o[a].startMarkerId,r)));return o}function v(e){for(var t=[],n=e.length-1;0<=n;n--)t[n]=r(e[n],!0);return t}function R(e,t){var n=h(t,e);n&&l(n)}c.util.extend(c,{saveRange:m,restoreRange:r,saveRanges:i,restoreRanges:v,saveSelection:function(e){if(!c.isSelectionValid(e))return a.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var t=c.getSelection(e),n=t.getAllRanges(),r=1==n.length&&t.isBackward(),o=i(n,r);return r?t.setSingleRange(n[0],r):t.setRanges(n),{win:e,rangeInfos:o,restored:!1}},restoreSelection:function(e,t){if(!e.restored){var n=e.rangeInfos,r=c.getSelection(e.win),o=v(n);1==n.length&&t&&c.features.selectionHasExtend&&n[0].backward?(r.removeAllRanges(),r.addRange(o[0],!0)):r.setRanges(o),e.restored=!0}},removeMarkerElement:R,removeMarkers:function(e){for(var t,n=e.rangeInfos,r=0,o=n.length;r<o;++r)(t=n[r]).collapsed?R(e.doc,t.markerId):(R(e.doc,t.startMarkerId),R(e.doc,t.endMarkerId))}})});var q=$,U={props:["lib","rangyConfig"],data:function(){return{articleNode:null,sectionNodes:null,paragraphNodes:null,selectionApplier:null,selection:null,selectionSaved:null,highlighter:null,highlightClasses:[]}},mounted:function(){this._initHighlighter(),this._initAnchorPosition(),this._initOnSelectEventListener()},methods:{_initAnchorPosition:function(){for(var e=0;e<this.rangyConfig.articleSelector.length;e++){var t=window.$(this.rangyConfig.articleSelector[e]);if(0<t.length){this.articleNode=t;break}}if(null===this.articleNode)throw this.$t("Cannot found any article node.");for(var n=this.articleNode.children(),r=0;r<this.rangyConfig.sectionSelector.length;r++){var o=n.filter(this.rangyConfig.sectionSelector[r]);if(0<o.length){this.sectionNodes=o;break}}if(null===this.sectionNodes)throw this.$t("Cannot found any section node.");this.sectionNodes.each(function(e,t){t.setAttribute("data-pacor-section-seq-id",e)}),this.sectionNodes.children().each(function(e,t){if(t.setAttribute("data-pacor-paragraph-seq-id",e),"string"!=typeof t.id||""===t.id){var n="pacor-paragraph-id-"+e;t.setAttribute("id",n)}})},_initOnSelectEventListener:function(){function e(){t.onselect()}var t=this;document.addEventListener("touchend",e),document.addEventListener("keyup",e),document.addEventListener("mouseup",e),document.addEventListener("mousedown",e),this._initSelectionApplier()},onselect:function(){var e=q.getSelection();if(0<e.toString().length){var t=e.getRangeAt(0).cloneRange().getBoundingDocumentRect();e.rect=t,e.anchorPosition={};var n=this._getNodesInRange(e.getAllRanges()),r=[],o=[],i=[];if(n.forEach(function(e){var t=(e=window.$(e)).parents("[data-pacor-section-seq-id]:first");if(1!==t.length)return!1;r.push(parseInt(t.attr("data-pacor-section-seq-id"),10));var n=e.parents("[data-pacor-paragraph-seq-id]:first");if(1!==n.length)return!1;o.push(parseInt(n.attr("data-pacor-paragraph-seq-id"),10)),i.push(n.attr("id"))}),0===r.length||0===o.length)return!1;e.anchorPosition={section_seq_id:r,paragraph_seq_id:o,paragraph_id:i},this.$emit("select",e),this.selection=e}else null!==this.selection&&(this.selection=null,this.$emit("selectcollapsed"))},_getNextNode:function(e){if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}},_getNodesInRange:function(e){var i=this,a=[];return!1===Array.isArray(e)&&(e=[e]),e.forEach(function(e){var t,n=e.startContainer,r=e.endContainer,o=e.commonAncestorContainer;for(t=n.parentNode;t&&(a.push(t),t!==o);t=t.parentNode);for(a.reverse(),t=n;t&&(a.push(t),t!==r);t=i._getNextNode(t));}),a},_initSelectionApplier:function(){var e=q.modules.ClassApplier;q.supported&&e&&e.supported&&(this.selectionApplier=q.createClassApplier("pacor-selection",{tagNames:["span","a","b","img"]}))},pinSelection:function(){return this.unpinSelection(),null!==this.selection&&!1!==Array.isArray(this.selection.anchorPosition.paragraph_seq_id)&&0!==this.selection.anchorPosition.paragraph_seq_id.length&&(this.selectionSaved=q.saveSelection(),this.selectionApplier.toggleSelection(),this.selection.removeAllRanges(),this)},unpinSelection:function(){return window.$(".pacor-selection").removeClass("pacor-selection"),this},highlightPinnedSelection:function(e){if(-1===this.highlightClasses.indexOf(e)||null===this.selectionSaved)return!1;q.restoreSelection(this.selectionSaved);var t=this.highlighter.highlightSelection(e,{exclusive:!1,containerElementId:this.selection.anchorPosition.paragraph_id[0]});return this.selection.removeAllRanges(),this.unpinSelection(),this.selection.highlight=t[0],this.selection},removeHighlightFromPinnedSelection:function(e){return-1!==this.highlightClasses.indexOf(e)&&null!==this.selectionSaved&&(q.restoreSelection(this.selectionSaved),this.highlighter.unhighlightSelection([e]),this.selection.removeAllRanges(),this.unpinSelection(),this.selection.highlightClassName=e,this.selection)},_initHighlighter:function(){if("object"!==ie()(this.rangyConfig.annotationTypeModules))return!1;var e=[];q.init(),this.highlighter=q.createHighlighter(),window.hl=this.highlighter;var t,n={ignoreWhiteSpace:!0,tagNames:["span","a","b","img"]};for(var r in this.rangyConfig.annotationTypeModules){var o=q.createClassApplier(r,n);if(this.highlighter.addClassApplier(o),this.highlightClasses.push(r),"object"===ie()(this.rangyConfig.annotationTypeModules[r].style)&&"string"==typeof this.rangyConfig.annotationTypeModules[r].style.highlight){var i=this.rangyConfig.annotationTypeModules[r].style.highlight;if("string"==typeof i){var a="[data-pacor-section-seq-id] [data-pacor-paragraph-seq-id] .".concat(r);e.push("".concat(a," {").concat(i,"}"))}}}0<e.length&&(0<window.document.styleSheets.length?t=window.document.styleSheets[0]:((t=document.createElement("style")).type="text/css",document.head.appendChild(t)),e.reverse(),e.forEach(function(e){t.insertRule(e,t.cssRules.length)}))},deserialize:function(e){Array.isArray(e)&&((e=e.map(function(e,t){return[e.start,e.end,t,e.className,e.paragraphID].join("$")})).unshift("type:textContent"),e=e.join("|")),this.highlighter.deserialize(e)}}},V=(n(301),n(2)),Y=Object(V.a)(U,r,[],!1,null,null,null);Y.options.__file="webpack-app/client/components/ReadingProgressesModuels/Reading/components/RangyManager/RangyManager.vue";t.default=Y.exports},319:function(e,t,n){"use strict";n.r(t);function r(){var n=this,e=n.$createElement,r=n._self._c||e;return r("div",{ref:"Selector",staticClass:"annotation-type-selector"},[r("vue-fab",{ref:"fab",attrs:{mainBtnColor:"#E6AD07",size:"big",iconType:"SemanticUI",activeIcon:"angle down",clickAutoCloseType:"fab",hideOnStart:!0,activeIconRotate:!1,transitionEnable:!0,scrollAutoShow:!1,clickOutsideCloseMenu:!1,autoOpenMenu:!0}},n._l(n.modules,function(t,e){return r("fab-item",{attrs:{idx:e,title:n.$t("ANNOTATION_TYPE."+t.type),icon:t.style.button.icon,btnColor:t.style.button.backgroundColor},on:{clickItem:function(e){return n.clickItem(t.type)}}})}),1)],1)}r._withStripped=!0;var o=n(1),i=n.n(o),a={props:["status","config","lib","selection"],data:function(){return this.$i18n.locale=this.config.locale,{}},watch:{selection:function(){var e=this.$refs.fab;null!==this.selection?e.onOffFab(!0):e.onOffFab(!1)}},computed:{modules:function(){var n=[],e=this.lib.auth.getCurrentStep();if("string"==typeof e){var r=this.status.readingConfig;if("object"===i()(r)){var t=r.readingProgressModules[e].annotationTypes;Array.isArray(t)&&t.forEach(function(e){var t=r.annotationTypeModules[e];"object"===i()(t)&&(t.type=e,n.push(t))})}}return n}},mounted:function(){},methods:{clickItem:function(e){console.log("clickItem",e)}}},s=(n(303),n(2)),c=n(305),l=Object(s.a)(a,r,[],!1,null,"31e52695",null);"function"==typeof c.default&&Object(c.default)(l),l.options.__file="webpack-app/client/components/ReadingProgressesModuels/Reading/components/AnnotationTypeSelector/AnnotationTypeSelector.vue";t.default=l.exports}}]);